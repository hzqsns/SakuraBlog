---
title: 微信图片提取文字
excerpt: '' 
author: Sakura
publishDate: '2024-09-03'
coverImage: 'https://pub-07075d3d3f844b7cac01396dfa381361.r2.dev/129021545_p0_master1200.jpg' 
slug: 'frontend-wechat-ocr'
date: 2024-09-03 08:52:00
tags:
  - OCR
category:
  - 前端
---

为了图方便我一直都是直接在微信上给自己发送图片然后直接复制图片上面的文字比较方便，有些OCR网站还需要上传图片然后一键识别显得十分麻烦，不禁有点好奇这其中的实现原理，予以整理。

## 正文

光学字符识别（OCR，Optical Character Recognition）技术是微信图片提取文字功能的核心。本文将重点分析OCR技术的原理，并探讨微信如何将其应用于PC版微信中的图片提取文字功能。为了更好地理解OCR技术，我们需要从以下几个方面进行剖析：

## 图像预处理：

旨在降低噪声，提高文字的可辨识度。以下是预处理的几个关键过程：

- 灰度化：将彩色图像转换为灰度图像，便于后续处理。灰度化是通过取颜色分量的加权平均值来实现的，公式为：Y = 0.299R + 0.587G + 0.114B。

- 二值化：将灰度图像转化为仅包含黑白两色的二值图像。阈值分割和自适应阈值分割是常用的二值化技术。自适应阈值分割根据图像局部区域的灰度变化来动态调整阈值。

- 形态学处理：应用腐蚀和膨胀等操作以减小噪声和边缘连接。这有助于将文字与背景区分开并提高识别准确性。

通俗理解：我们先将复杂的彩色图片化简为灰度图片（黑白图片）。首先打开图片编辑软件（如Photoshop），然后使用软件的功能，将彩色图片转换为灰度图片。接下来，我们需要进一步将灰度图片变为只包含黑白两种颜色的简单图片，这个过程叫做二值化，可以尝试寻找一些二值化的在线工具来帮助实现这个操作。


## 文字区域检测

预处理之后，下一步是定位图像中的文字区域。文字区域检测方法有多种，常见的有基于像素统计的投影法、基于边缘检测的SWT（Stroke Width Transform）方法等。这些方法可以帮助OCR系统确定图像中潜在的文字所在位置，为接下来的字符分割和识别做准备。

- 投影法：基于文字在水平和竖直方向上的排列特性进行检测。将图像中的像素沿垂直和水平方向进行投影，统计每一行（列）的黑白像素变化情况，识别出文字所在的区域。

- SWT方法：基于边缘检测，在计算边缘点之间的距离和投票后，将具有相似笔画宽度的边缘点聚集在一起，形成候选文字区域。

- 基于深度学习的检测：利用深度学习模型对输入图像进行检测。经典的模型有Text-FCN、TextBoxes、EAST等，这些模型具有较高的检测准确度。

通俗理解：要检测出图片里的文字区域，我们可以尝试以下方法：投影法：在图片上用直线描绘文字的行和列，找到文字区域的边界。在计算机视觉领域，这是一个较为简单的方法，但对于一些规律性较强的图片，效果还是不错的。对于更准确的检测结果，我们需要借助一些现有的深度学习技术，可以尝试阅读有关Text-FCN、TextBoxes、EAST等模型的相关教程，并运用在实际项目中。

## 字符分割和识别

在完成文字区域检测后，OCR系统需要将连续的文字分割成单个字符，然后利用预先训练好的模型对分割出的字符进行识别。传统的字符识别方法包括基于特征提取的模板匹配、基于聚类的K-means算法等，但这些方法在处理复杂场景和多样文字时准确率较低。

近年来，基于深度学习的字符识别方法逐渐成为主流。典型如卷积神经网络（CNN，Convolutional Neural Network）和循环神经网络（RNN，Recurrent Neural Network）等，它们分别可以处理图像数据和序列数据。针对图片提取文字任务，较为常见的技术组合是使用CNN进行特征提取，然后将特征传递给RNN进行序列识别。

通俗理解：字符分割的目的是将文字区域内的每个字符分开，以便识别。在此阶段，我们可以考虑以下方法：利用一些基础的图像处理方法（如连通区域分析）来实现字符分割。这些方法在简单场景下可能工作得很好，但在处理复杂数字场景时可能显得力不从心。好在现在有很多现成的深度学习模型（如CNN和RNN）可供我们使用，这些模型已经在大量字符识别任务中进行了训练，因此准确性和稳定性都有较好的表现。


## 微信PC版本实现原理推测
- 当用户在微信PC版中选择“提取图片文字”功能时，微信客户端首先将选定的图片发送至后台服务器。

- 后台服务器处理这张图片，会对其进行预处理操作（如灰度化、二值化等），以提高文字识别的准确性。

- 在完成预处理之后，服务器会通过深度学习模型识别文本区域和进行字符分割。微信的OCR技术团队很可能已经训练了一个或多个用于识别和分割字符的模型，这些模型可能基于CNN、RNN等神经网络结构。

- 将识别出的文本区域和字符进行识别，通过神经网络模型生成字符序列，这一过程可能是基于RNN等序列处理网络来实现的。

- 服务器将识别出的文字内容返回到微信客户端，这些文字可能包括空格符和换行符，以保持相对应的文本格式。

- 用户在微信客户端上看到返回的文字内容，可以直接复制或与其他用户分享。微信已经完成了从图片提取文字的整个过程。

## 结论

概括而言，微信图片提取文字功能的核心技术是基于深度学习的OCR技术，涵盖了图像预处理、文字区域检测、字符分割和识别等多个环节。微信在实现过程中将OCR技术与软件使用场景相结合，为用户带来了更加便捷的体验。


参考资料：
[三年磨一剑——微信OCR图片文字提取](https://cloud.tencent.com/developer/article/1798403)
[微信图片文本提取功能的实现](https://juejin.cn/post/7241498912917930044)


